# 基金投资组合可视化系统

## 📖 项目简介

基金投资组合可视化系统是一个基于 Streamlit 的数据分析和可视化平台，专门用于基金投资组合的管理、分析和展示。系统支持净值数据管理、持仓分析、指数分布分析、行业分析、可转债分析以及实时持仓热力图等功能。

## ✨ 主要功能

### 🏠 数据概览
- **净值走势图**：交互式净值曲线展示，支持单位净值和累计净值
- **持仓明细**：按日期查看详细持仓信息
- **统计指标**：总收益率、波动率、最高/最低净值等关键指标
- **智能分析**：根据持仓类型自动切换分析模式

### 📊 持仓分析
- **指数分布**：持仓在沪深300、中证500、中证1000、中证2000等主要指数的分布
- **行业分布**：按行业分类的持仓比例分析
- **市场分布**：科创板、创业板、主板的持仓分布
- **可转债分析**：
  - 股性/债性强弱分析（基于转股溢价率）
  - 外部评级分布
  - 正股市值分布
  - 行业分布

### 🔥 实时持仓热力图
- **动态热力图**：以 TreeMap 形式展示持仓股票的涨跌情况
- **双模式展示**：
  - 价格涨跌模式：面积基于涨跌幅大小
  - 收益贡献模式：面积基于对组合收益的贡献度
- **实时收益率**：自动计算当日收益率（包含期货资产）
- **统计信息**：涨跌股票数量、总市值等实时数据

### 📤 数据导入
- **产品管理**：添加、删除产品，管理产品基本信息
- **净值导入**：支持 CSV、Excel 格式的净值数据导入
- **持仓导入**：
  - 矩阵格式：行为日期，列为股票代码
  - 长格式：标准的关系型数据格式
  - 批量导入：支持多文件同时导入
- **智能解析**：自动识别列名，支持多种数据格式

### 📋 指数成分股管理
- **指数数据导入**：支持主要指数成分股数据导入
- **行业分类导入**：支持自定义行业分类数据
- **数据概览**：查看已导入的指数和行业数据统计

### 💰 收益率计算
- **多资产整合**：自动整合现货资产和期货资产
- **准确计算**：基于实际资产文件计算真实收益率
- **历史对比**：支持不同时间段的收益率比较

## 🗂️ 项目结构

```
fund_visualization/
├── app.py                          # 主应用入口
├── config.py                       # 配置文件
├── fund_data.db                    # SQLite数据库
├── components/                     # 功能组件
│   ├── __init__.py
│   ├── analysis.py                 # 持仓分析
│   ├── conv_bond_analysis.py       # 可转债分析
│   ├── data_import.py              # 数据导入
│   ├── index_import.py             # 指数管理
│   ├── industry_analysis.py        # 行业分析
│   ├── nav_chart.py                # 净值图表
│   ├── product_returns.py          # 收益率计算
│   └── realtime_heatmap.py         # 实时热力图
├── database/
│   ├── __init__.py
│   └── database.py                 # 数据库管理
└── data/
    ├── conv_bond/                  # 可转债数据
    │   ├── 可转债正股关联_*.csv
    │   └── 可转债分析数据_*.csv
    └── sample_data.csv             # 示例数据
```

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Streamlit
- pandas
- plotly
- sqlite3

### 安装依赖
```bash
pip install streamlit pandas plotly
```

### 运行应用
```bash
streamlit run app.py
```

### 初始化数据
1. 启动应用后，首先在"数据导入" → "产品管理"中添加产品
2. 导入净值数据和持仓数据
3. 在"指数成分股管理"中导入指数成分股和行业分类数据
4. 在"数据概览"中查看分析结果

## 📁 数据格式要求

### 净值数据格式
```csv
日期,单位净值,累计净值
2024-01-01,1.0000,1.0000
2024-01-02,1.0012,1.0012
```

### 持仓数据格式

**矩阵格式：**
```csv
日期,000001.SZ,600519.SH,600036.SH
20240131,1000,2000,1500
20240229,1200,1800,1400
```

**长格式：**
```csv
日期,股票代码,股票名称,持仓比例
2024-03-31,600519.SH,贵州茅台,8.5
2024-03-31,600036.SH,招商银行,6.1
```

### 指数成分股格式
```csv
证券代码,证券名称,权重
000001.SZ,平安银行,1.5
600519.SH,贵州茅台,4.8
```

### 行业分类格式
```csv
行业名称,股票代码
银行,000001
白酒,600519
```

## 📊 数据源配置

系统支持自动读取以下路径的数据文件：

- **现货资产**：`C:\shared_data\实盘\交易数据定频导出\`
- **期货资产**：`C:\shared_data\期货\`
- **可转债数据**：`data/conv_bond/`

## 🎨 功能特色

### 智能分析
- 自动识别持仓类型（股票、可转债或混合）
- 根据持仓类型展示相应的分析维度
- 动态调整分析图表和指标

### 高级可视化
- 响应式设计，支持深色/浅色主题
- 交互式图表，支持缩放、悬停等操作
- 专业的配色方案，数据展示清晰美观

### 实时数据
- 自动读取最新的交易数据
- 实时计算收益率和持仓变化
- 支持自动刷新功能

## 🔧 配置说明

### 主要指数配置
```python
MAJOR_INDICES = {
    "沪深300": "000300",
    "中证500": "000905", 
    "中证1000": "000852",
    "中证2000": "932000"
}
```

### 数据库配置
- 使用 SQLite 本地数据库
- 自动创建和管理数据表
- 支持数据的增删改查操作

## 🤝 使用建议

1. **数据准备**：确保数据格式符合要求，建议先用小批量数据测试
2. **定期备份**：重要数据建议定期备份数据库文件
3. **性能优化**：大数据量时建议分批导入，避免内存溢出
4. **错误处理**：遇到导入错误时，检查数据格式和编码方式

## 📝 更新日志

### v1.0.0
- 基础功能实现
- 支持净值和持仓数据管理
- 实现基础分析功能

### v1.1.0
- 新增可转债分析功能
- 实时热力图功能
- 优化用户界面

### v1.2.0
- 集成期货资产计算
- 完善收益率计算逻辑
- 增强数据导入功能

## 📧 联系方式

如有问题或建议，请通过以下方式联系：
- 项目维护者：[您的姓名]
- 邮箱：[您的邮箱]

## 📄 许可证

本项目采用 MIT 许可证，详情请查看 LICENSE 文件。

---

**感谢使用基金投资组合可视化系统！**